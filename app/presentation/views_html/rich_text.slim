/ rich_text.slim
.lyrics.p-4 style="font-size: 1.2rem; line-height: 2;"
  - vocabulary.sep_text.split.each do |text_word|
    - unique_word = vocabulary.unique_words.find { |w| w.characters == text_word }
    - if unique_word
      span[
        class="#{unique_word.language_level} cursor-pointer"
        style="cursor: pointer;"
        onclick="handleWordClick(this)"
        data-word=unique_word.characters
        data-translation=unique_word.translation
        data-pinyin=unique_word.pinyin
        data-definition=unique_word.definition
        data-example=unique_word.example_sentence
        data-level=unique_word.language_level.gsub('-class', '')
      ] = "#{text_word} "
    - else
      span = "#{text_word} "

javascript:
  function handleWordClick(element) {
    const wordData = {
      word: element.dataset.word,
      translation: element.dataset.translation,
      pinyin: element.dataset.pinyin,
      definition: element.dataset.definition,
      example: element.dataset.example,
      level: element.dataset.level,
      className: element.className
    };
    
    const existingCard = document.querySelector(`.word-card[data-word="${wordData.word}"]`);
    if (existingCard) return;
    
    const card = document.createElement('div');
    card.className = 'card word-card mb-3';
    card.setAttribute('data-word', wordData.word);
    
    card.innerHTML = `
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-start">
          <div style="flex: 1;">
            <h5 class="card-title mb-3">
              <span class="${wordData.level}-class" style="font-size: 1.5rem;">
                ${wordData.word}
              </span>
            </h5>
            <div class="vocabulary-details">
              <div class="mb-2">
                <strong class="text-muted">pinyin：</strong>
                <span class="card-subtitle">${wordData.pinyin}</span>
              </div>
              <div class="mb-2">
                <strong class="text-muted">translation：</strong>
                <span>${wordData.translation}</span>
              </div>
              <div class="mb-2">
                <strong class="text-muted">definition：</strong>
                <span>${wordData.definition || wordData.translation}</span>
              </div>
              <div class="mb-2">
                <strong class="text-muted">example_sentence：</strong>
                <span>${wordData.example}</span>
              </div>
              <div>
                <strong class="text-muted">Level：</strong>
                <span>${getLevelName(wordData.level)}</span>
              </div>
            </div>
          </div>
          <button class="btn text-dark" style="padding: 0 8px; font-size: 1.5rem; line-height: 1;" onclick="removeWord(this)">×</button>
        </div>
      </div>
    `;
    
    const vocabularyDetails = document.getElementById('vocabulary-details');
    vocabularyDetails.insertBefore(card, vocabularyDetails.firstChild);
  }
  
  function removeWord(button) {
    button.closest('.word-card').remove();
  }
  
  function getLevelName(level) {
    const levelMap = {
      'beginner': 'Basic',
      'novice1': 'Basic',
      'novice2': 'Basic',
      'level1': 'Intermediate',
      'level2': 'Intermediate',
      'level3': 'Intermediate',
      'level4': 'Advance',
      'level5': 'Advance'
    };
    return levelMap[level] || level;
  }